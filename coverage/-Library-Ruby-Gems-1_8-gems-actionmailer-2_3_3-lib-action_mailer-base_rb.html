<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>/Library/Ruby/Gems/1.8/gems/actionmailer-2.3.3/lib/action_mailer/base.rb</title>
    <link href="screen.css" media="all" rel="stylesheet" type="text/css" />
    <link href="print.css" media="print" rel="stylesheet" type="text/css" />
    
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
    <script type="text/javascript" src="rcov.js"></script>
  </head>
  <body>
    <h1>Rails Rrdtool C0 Coverage Information - RCov</h1>
    <h2>/Library/Ruby/Gems/1.8/gems/actionmailer-2.3.3/lib/action_mailer/base.rb</h2>

    

    <div class="report_table_wrapper">
      <table class='report' id='report_table'>
        <thead>
          <tr>
            <th class="left_align">Name</th>
            <th class="right_align">Total Lines</th>
            <th class="right_align">Lines of Code</th>
            <th class="left_align">Total Coverage</th>
            <th class="left_align">Code Coverage</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="left_align"><a href="-Library-Ruby-Gems-1_8-gems-actionmailer-2_3_3-lib-action_mailer-base_rb.html">/Library/Ruby/Gems/1.8/gems/actionmailer-2.3.3/lib/action_mailer/base.rb</a></td>
            <td class='right_align'><tt>705</tt></td>
            <td class='right_align'><tt>302</tt></td>
            <td class="left_align"><div class="percent_graph_legend"><tt class=''>65.53%</tt></div>
          <div class="percent_graph">
            <div class="covered" style="width:66px"></div>
            <div class="uncovered" style="width:34px"></div>
          </div></td>
            <td class="left_align"><div class="percent_graph_legend"><tt class=''>33.11%</tt></div>
          <div class="percent_graph">
            <div class="covered" style="width:33px"></div>
            <div class="uncovered" style="width:67px"></div>
          </div></td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <h3>Key</h3>
    
    <div class="key"><pre><span class='marked'>Code reported as executed by Ruby looks like this...</span><span class='marked1'>and this: this line is also marked as covered.</span><span class='inferred'>Lines considered as run by rcov, but not reported by Ruby, look like this,</span><span class='inferred1'>and this: these lines were inferred by rcov (using simple heuristics).</span><span class='uncovered'>Finally, here's a line marked as not executed.</span></pre></div>

    <h3>Coverage Details</h3>

    <table class="details">
      <tbody>
        
          
          
          <tr class="marked">
            <td><pre><a name="line1">1</a> module ActionMailer #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line2">2</a>   # Action Mailer allows you to send email from your application using a mailer model and views.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line3">3</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line4">4</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line5">5</a>   # = Mailer Models</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line6">6</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line7">7</a>   # To use Action Mailer, you need to create a mailer model.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line8">8</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line9">9</a>   #   $ script/generate mailer Notifier</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line10">10</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line11">11</a>   # The generated model inherits from ActionMailer::Base. Emails are defined by creating methods within the model which are then</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line12">12</a>   # used to set variables to be used in the mail template, to change options on the mail, or</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line13">13</a>   # to add attachments.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line14">14</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line15">15</a>   # Examples:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line16">16</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line17">17</a>   #  class Notifier &lt; ActionMailer::Base</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line18">18</a>   #    def signup_notification(recipient)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line19">19</a>   #      recipients recipient.email_address_with_name</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line20">20</a>   #      bcc        [&quot;bcc@example.com&quot;, &quot;Order Watcher &lt;watcher@example.com&gt;&quot;]</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line21">21</a>   #      from       &quot;system@example.com&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line22">22</a>   #      subject    &quot;New account information&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line23">23</a>   #      body       :account =&gt; recipient</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line24">24</a>   #    end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line25">25</a>   #  end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line26">26</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line27">27</a>   # Mailer methods have the following configuration methods available.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line28">28</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line29">29</a>   # * &lt;tt&gt;recipients&lt;/tt&gt; - Takes one or more email addresses. These addresses are where your email will be delivered to. Sets the &lt;tt&gt;To:&lt;/tt&gt; header.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line30">30</a>   # * &lt;tt&gt;subject&lt;/tt&gt; - The subject of your email. Sets the &lt;tt&gt;Subject:&lt;/tt&gt; header.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line31">31</a>   # * &lt;tt&gt;from&lt;/tt&gt; - Who the email you are sending is from. Sets the &lt;tt&gt;From:&lt;/tt&gt; header.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line32">32</a>   # * &lt;tt&gt;cc&lt;/tt&gt; - Takes one or more email addresses. These addresses will receive a carbon copy of your email. Sets the &lt;tt&gt;Cc:&lt;/tt&gt; header.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line33">33</a>   # * &lt;tt&gt;bcc&lt;/tt&gt; - Takes one or more email addresses. These addresses will receive a blind carbon copy of your email. Sets the &lt;tt&gt;Bcc:&lt;/tt&gt; header.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line34">34</a>   # * &lt;tt&gt;reply_to&lt;/tt&gt; - Takes one or more email addresses. These addresses will be listed as the default recipients when replying to your email. Sets the &lt;tt&gt;Reply-To:&lt;/tt&gt; header.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line35">35</a>   # * &lt;tt&gt;sent_on&lt;/tt&gt; - The date on which the message was sent. If not set, the header wil be set by the delivery agent.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line36">36</a>   # * &lt;tt&gt;content_type&lt;/tt&gt; - Specify the content type of the message. Defaults to &lt;tt&gt;text/plain&lt;/tt&gt;.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line37">37</a>   # * &lt;tt&gt;headers&lt;/tt&gt; - Specify additional headers to be set for the message, e.g. &lt;tt&gt;headers 'X-Mail-Count' =&gt; 107370&lt;/tt&gt;.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line38">38</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line39">39</a>   # When a &lt;tt&gt;headers 'return-path'&lt;/tt&gt; is specified, that value will be used as the 'envelope from'</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line40">40</a>   # address. Setting this is useful when you want delivery notifications sent to a different address than</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line41">41</a>   # the one in &lt;tt&gt;from&lt;/tt&gt;.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line42">42</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line43">43</a>   # The &lt;tt&gt;body&lt;/tt&gt; method has special behavior. It takes a hash which generates an instance variable</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line44">44</a>   # named after each key in the hash containing the value that that key points to.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line45">45</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line46">46</a>   # So, for example, &lt;tt&gt;body :account =&gt; recipient&lt;/tt&gt; would result</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line47">47</a>   # in an instance variable &lt;tt&gt;@account&lt;/tt&gt; with the value of &lt;tt&gt;recipient&lt;/tt&gt; being accessible in the</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line48">48</a>   # view.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line49">49</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line50">50</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line51">51</a>   # = Mailer views</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line52">52</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line53">53</a>   # Like Action Controller, each mailer class has a corresponding view directory</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line54">54</a>   # in which each method of the class looks for a template with its name.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line55">55</a>   # To define a template to be used with a mailing, create an &lt;tt&gt;.erb&lt;/tt&gt; file with the same name as the method</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line56">56</a>   # in your mailer model. For example, in the mailer defined above, the template at</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line57">57</a>   # &lt;tt&gt;app/views/notifier/signup_notification.erb&lt;/tt&gt; would be used to generate the email.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line58">58</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line59">59</a>   # Variables defined in the model are accessible as instance variables in the view.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line60">60</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line61">61</a>   # Emails by default are sent in plain text, so a sample view for our model example might look like this:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line62">62</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line63">63</a>   #   Hi &lt;%= @account.name %&gt;,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line64">64</a>   #   Thanks for joining our service! Please check back often.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line65">65</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line66">66</a>   # You can even use Action Pack helpers in these views. For example:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line67">67</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line68">68</a>   #   You got a new note!</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line69">69</a>   #   &lt;%= truncate(note.body, 25) %&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line70">70</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line71">71</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line72">72</a>   # = Generating URLs</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line73">73</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line74">74</a>   # URLs can be generated in mailer views using &lt;tt&gt;url_for&lt;/tt&gt; or named routes.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line75">75</a>   # Unlike controllers from Action Pack, the mailer instance doesn't have any context about the incoming request,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line76">76</a>   # so you'll need to provide all of the details needed to generate a URL.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line77">77</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line78">78</a>   # When using &lt;tt&gt;url_for&lt;/tt&gt; you'll need to provide the &lt;tt&gt;:host&lt;/tt&gt;, &lt;tt&gt;:controller&lt;/tt&gt;, and &lt;tt&gt;:action&lt;/tt&gt;:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line79">79</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line80">80</a>   #   &lt;%= url_for(:host =&gt; &quot;example.com&quot;, :controller =&gt; &quot;welcome&quot;, :action =&gt; &quot;greeting&quot;) %&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line81">81</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line82">82</a>   # When using named routes you only need to supply the &lt;tt&gt;:host&lt;/tt&gt;:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line83">83</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line84">84</a>   #   &lt;%= users_url(:host =&gt; &quot;example.com&quot;) %&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line85">85</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line86">86</a>   # You will want to avoid using the &lt;tt&gt;name_of_route_path&lt;/tt&gt; form of named routes because it doesn't make sense to</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line87">87</a>   # generate relative URLs in email messages.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line88">88</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line89">89</a>   # It is also possible to set a default host that will be used in all mailers by setting the &lt;tt&gt;:host&lt;/tt&gt; option in</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line90">90</a>   # the &lt;tt&gt;ActionMailer::Base.default_url_options&lt;/tt&gt; hash as follows:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line91">91</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line92">92</a>   #   ActionMailer::Base.default_url_options[:host] = &quot;example.com&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line93">93</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line94">94</a>   # This can also be set as a configuration option in &lt;tt&gt;config/environment.rb&lt;/tt&gt;:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line95">95</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line96">96</a>   #   config.action_mailer.default_url_options = { :host =&gt; &quot;example.com&quot; }</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line97">97</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line98">98</a>   # If you do decide to set a default &lt;tt&gt;:host&lt;/tt&gt; for your mailers you will want to use the</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line99">99</a>   # &lt;tt&gt;:only_path =&gt; false&lt;/tt&gt; option when using &lt;tt&gt;url_for&lt;/tt&gt;. This will ensure that absolute URLs are generated because</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line100">100</a>   # the &lt;tt&gt;url_for&lt;/tt&gt; view helper will, by default, generate relative URLs when a &lt;tt&gt;:host&lt;/tt&gt; option isn't</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line101">101</a>   # explicitly provided.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line102">102</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line103">103</a>   # = Sending mail</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line104">104</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line105">105</a>   # Once a mailer action and template are defined, you can deliver your message or create it and save it</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line106">106</a>   # for delivery later:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line107">107</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line108">108</a>   #   Notifier.deliver_signup_notification(david) # sends the email</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line109">109</a>   #   mail = Notifier.create_signup_notification(david)  # =&gt; a tmail object</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line110">110</a>   #   Notifier.deliver(mail)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line111">111</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line112">112</a>   # You never instantiate your mailer class. Rather, your delivery instance</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line113">113</a>   # methods are automatically wrapped in class methods that start with the word</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line114">114</a>   # &lt;tt&gt;deliver_&lt;/tt&gt; followed by the name of the mailer method that you would</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line115">115</a>   # like to deliver. The &lt;tt&gt;signup_notification&lt;/tt&gt; method defined above is</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line116">116</a>   # delivered by invoking &lt;tt&gt;Notifier.deliver_signup_notification&lt;/tt&gt;.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line117">117</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line118">118</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line119">119</a>   # = HTML email</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line120">120</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line121">121</a>   # To send mail as HTML, make sure your view (the &lt;tt&gt;.erb&lt;/tt&gt; file) generates HTML and</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line122">122</a>   # set the content type to html.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line123">123</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line124">124</a>   #   class MyMailer &lt; ActionMailer::Base</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line125">125</a>   #     def signup_notification(recipient)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line126">126</a>   #       recipients   recipient.email_address_with_name</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line127">127</a>   #       subject      &quot;New account information&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line128">128</a>   #       from         &quot;system@example.com&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line129">129</a>   #       body         :account =&gt; recipient</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line130">130</a>   #       content_type &quot;text/html&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line131">131</a>   #     end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line132">132</a>   #   end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line133">133</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line134">134</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line135">135</a>   # = Multipart email</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line136">136</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line137">137</a>   # You can explicitly specify multipart messages:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line138">138</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line139">139</a>   #   class ApplicationMailer &lt; ActionMailer::Base</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line140">140</a>   #     def signup_notification(recipient)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line141">141</a>   #       recipients      recipient.email_address_with_name</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line142">142</a>   #       subject         &quot;New account information&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line143">143</a>   #       from            &quot;system@example.com&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line144">144</a>   #       content_type    &quot;multipart/alternative&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line145">145</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line146">146</a>   #       part :content_type =&gt; &quot;text/html&quot;,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line147">147</a>   #         :body =&gt; render_message(&quot;signup-as-html&quot;, :account =&gt; recipient)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line148">148</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line149">149</a>   #       part &quot;text/plain&quot; do |p|</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line150">150</a>   #         p.body = render_message(&quot;signup-as-plain&quot;, :account =&gt; recipient)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line151">151</a>   #         p.transfer_encoding = &quot;base64&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line152">152</a>   #       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line153">153</a>   #     end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line154">154</a>   #   end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line155">155</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line156">156</a>   # Multipart messages can also be used implicitly because Action Mailer will automatically</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line157">157</a>   # detect and use multipart templates, where each template is named after the name of the action, followed</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line158">158</a>   # by the content type. Each such detected template will be added as separate part to the message.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line159">159</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line160">160</a>   # For example, if the following templates existed:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line161">161</a>   # * signup_notification.text.plain.erb</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line162">162</a>   # * signup_notification.text.html.erb</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line163">163</a>   # * signup_notification.text.xml.builder</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line164">164</a>   # * signup_notification.text.x-yaml.erb</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line165">165</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line166">166</a>   # Each would be rendered and added as a separate part to the message,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line167">167</a>   # with the corresponding content type. The content type for the entire</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line168">168</a>   # message is automatically set to &lt;tt&gt;multipart/alternative&lt;/tt&gt;, which indicates</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line169">169</a>   # that the email contains multiple different representations of the same email</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line170">170</a>   # body. The same body hash is passed to each template.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line171">171</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line172">172</a>   # Implicit template rendering is not performed if any attachments or parts have been added to the email.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line173">173</a>   # This means that you'll have to manually add each part to the email and set the content type of the email</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line174">174</a>   # to &lt;tt&gt;multipart/alternative&lt;/tt&gt;.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line175">175</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line176">176</a>   # = Attachments</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line177">177</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line178">178</a>   # Attachments can be added by using the +attachment+ method.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line179">179</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line180">180</a>   # Example:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line181">181</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line182">182</a>   #   class ApplicationMailer &lt; ActionMailer::Base</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line183">183</a>   #     # attachments</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line184">184</a>   #     def signup_notification(recipient)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line185">185</a>   #       recipients      recipient.email_address_with_name</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line186">186</a>   #       subject         &quot;New account information&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line187">187</a>   #       from            &quot;system@example.com&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line188">188</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line189">189</a>   #       attachment :content_type =&gt; &quot;image/jpeg&quot;,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line190">190</a>   #         :body =&gt; File.read(&quot;an-image.jpg&quot;)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line191">191</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line192">192</a>   #       attachment &quot;application/pdf&quot; do |a|</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line193">193</a>   #         a.body = generate_your_pdf_here()</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line194">194</a>   #       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line195">195</a>   #     end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line196">196</a>   #   end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line197">197</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line198">198</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line199">199</a>   # = Configuration options</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line200">200</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line201">201</a>   # These options are specified on the class level, like &lt;tt&gt;ActionMailer::Base.template_root = &quot;/my/templates&quot;&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line202">202</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line203">203</a>   # * &lt;tt&gt;template_root&lt;/tt&gt; - Determines the base from which template references will be made.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line204">204</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line205">205</a>   # * &lt;tt&gt;logger&lt;/tt&gt; - the logger is used for generating information on the mailing run if available.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line206">206</a>   #   Can be set to nil for no logging. Compatible with both Ruby's own Logger and Log4r loggers.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line207">207</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line208">208</a>   # * &lt;tt&gt;smtp_settings&lt;/tt&gt; - Allows detailed configuration for &lt;tt&gt;:smtp&lt;/tt&gt; delivery method:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line209">209</a>   #   * &lt;tt&gt;:address&lt;/tt&gt; - Allows you to use a remote mail server. Just change it from its default &quot;localhost&quot; setting.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line210">210</a>   #   * &lt;tt&gt;:port&lt;/tt&gt; - On the off chance that your mail server doesn't run on port 25, you can change it.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line211">211</a>   #   * &lt;tt&gt;:domain&lt;/tt&gt; - If you need to specify a HELO domain, you can do it here.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line212">212</a>   #   * &lt;tt&gt;:user_name&lt;/tt&gt; - If your mail server requires authentication, set the username in this setting.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line213">213</a>   #   * &lt;tt&gt;:password&lt;/tt&gt; - If your mail server requires authentication, set the password in this setting.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line214">214</a>   #   * &lt;tt&gt;:authentication&lt;/tt&gt; - If your mail server requires authentication, you need to specify the authentication type here.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line215">215</a>   #     This is a symbol and one of &lt;tt&gt;:plain&lt;/tt&gt;, &lt;tt&gt;:login&lt;/tt&gt;, &lt;tt&gt;:cram_md5&lt;/tt&gt;.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line216">216</a>   #   * &lt;tt&gt;:enable_starttls_auto&lt;/tt&gt; - When set to true, detects if STARTTLS is enabled in your SMTP server and starts to use it.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line217">217</a>   #     It works only on Ruby &gt;= 1.8.7 and Ruby &gt;= 1.9. Default is true.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line218">218</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line219">219</a>   # * &lt;tt&gt;sendmail_settings&lt;/tt&gt; - Allows you to override options for the &lt;tt&gt;:sendmail&lt;/tt&gt; delivery method.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line220">220</a>   #   * &lt;tt&gt;:location&lt;/tt&gt; - The location of the sendmail executable. Defaults to &lt;tt&gt;/usr/sbin/sendmail&lt;/tt&gt;.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line221">221</a>   #   * &lt;tt&gt;:arguments&lt;/tt&gt; - The command line arguments. Defaults to &lt;tt&gt;-i -t&lt;/tt&gt;.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line222">222</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line223">223</a>   # * &lt;tt&gt;raise_delivery_errors&lt;/tt&gt; - Whether or not errors should be raised if the email fails to be delivered.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line224">224</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line225">225</a>   # * &lt;tt&gt;delivery_method&lt;/tt&gt; - Defines a delivery method. Possible values are &lt;tt&gt;:smtp&lt;/tt&gt; (default), &lt;tt&gt;:sendmail&lt;/tt&gt;, and &lt;tt&gt;:test&lt;/tt&gt;.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line226">226</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line227">227</a>   # * &lt;tt&gt;perform_deliveries&lt;/tt&gt; - Determines whether &lt;tt&gt;deliver_*&lt;/tt&gt; methods are actually carried out. By default they are,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line228">228</a>   #   but this can be turned off to help functional testing.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line229">229</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line230">230</a>   # * &lt;tt&gt;deliveries&lt;/tt&gt; - Keeps an array of all the emails sent out through the Action Mailer with &lt;tt&gt;delivery_method :test&lt;/tt&gt;. Most useful</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line231">231</a>   #   for unit and functional testing.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line232">232</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line233">233</a>   # * &lt;tt&gt;default_charset&lt;/tt&gt; - The default charset used for the body and to encode the subject. Defaults to UTF-8. You can also</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line234">234</a>   #   pick a different charset from inside a method with +charset+.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line235">235</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line236">236</a>   # * &lt;tt&gt;default_content_type&lt;/tt&gt; - The default content type used for the main part of the message. Defaults to &quot;text/plain&quot;. You</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line237">237</a>   #   can also pick a different content type from inside a method with +content_type+.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line238">238</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line239">239</a>   # * &lt;tt&gt;default_mime_version&lt;/tt&gt; - The default mime version used for the message. Defaults to &lt;tt&gt;1.0&lt;/tt&gt;. You</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line240">240</a>   #   can also pick a different value from inside a method with +mime_version+.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line241">241</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line242">242</a>   # * &lt;tt&gt;default_implicit_parts_order&lt;/tt&gt; - When a message is built implicitly (i.e. multiple parts are assembled from templates</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line243">243</a>   #   which specify the content type in their filenames) this variable controls how the parts are ordered. Defaults to</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line244">244</a>   #   &lt;tt&gt;[&quot;text/html&quot;, &quot;text/enriched&quot;, &quot;text/plain&quot;]&lt;/tt&gt;. Items that appear first in the array have higher priority in the mail client</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line245">245</a>   #   and appear last in the mime encoded message. You can also pick a different order from inside a method with</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line246">246</a>   #   +implicit_parts_order+.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line247">247</a>   class Base</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line248">248</a>     include AdvAttrAccessor, PartContainer, Quoting, Utils</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line249">249</a>     if Object.const_defined?(:ActionController)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line250">250</a>       include ActionController::UrlWriter</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line251">251</a>       include ActionController::Layout</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line252">252</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line253">253</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line254">254</a>     private_class_method :new #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line255">255</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line256">256</a>     class_inheritable_accessor :view_paths</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line257">257</a>     self.view_paths = []</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line258">258</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line259">259</a>     cattr_accessor :logger</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line260">260</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line261">261</a>     @@smtp_settings = {</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line262">262</a>       :address              =&gt; &quot;localhost&quot;,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line263">263</a>       :port                 =&gt; 25,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line264">264</a>       :domain               =&gt; 'localhost.localdomain',</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line265">265</a>       :user_name            =&gt; nil,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line266">266</a>       :password             =&gt; nil,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line267">267</a>       :authentication       =&gt; nil,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line268">268</a>       :enable_starttls_auto =&gt; true,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line269">269</a>     }</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line270">270</a>     cattr_accessor :smtp_settings</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line271">271</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line272">272</a>     @@sendmail_settings = {</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line273">273</a>       :location       =&gt; '/usr/sbin/sendmail',</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line274">274</a>       :arguments      =&gt; '-i -t'</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line275">275</a>     }</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line276">276</a>     cattr_accessor :sendmail_settings</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line277">277</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line278">278</a>     @@raise_delivery_errors = true</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line279">279</a>     cattr_accessor :raise_delivery_errors</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line280">280</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line281">281</a>     superclass_delegating_accessor :delivery_method</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line282">282</a>     self.delivery_method = :smtp</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line283">283</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line284">284</a>     @@perform_deliveries = true</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line285">285</a>     cattr_accessor :perform_deliveries</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line286">286</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line287">287</a>     @@deliveries = []</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line288">288</a>     cattr_accessor :deliveries</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line289">289</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line290">290</a>     @@default_charset = &quot;utf-8&quot;</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line291">291</a>     cattr_accessor :default_charset</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line292">292</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line293">293</a>     @@default_content_type = &quot;text/plain&quot;</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line294">294</a>     cattr_accessor :default_content_type</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line295">295</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line296">296</a>     @@default_mime_version = &quot;1.0&quot;</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line297">297</a>     cattr_accessor :default_mime_version</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line298">298</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line299">299</a>     @@default_implicit_parts_order = [ &quot;text/html&quot;, &quot;text/enriched&quot;, &quot;text/plain&quot; ]</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line300">300</a>     cattr_accessor :default_implicit_parts_order</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line301">301</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line302">302</a>     cattr_reader :protected_instance_variables</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line303">303</a>     @@protected_instance_variables = %w(@body)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line304">304</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line305">305</a>     # Specify the BCC addresses for the message</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line306">306</a>     adv_attr_accessor :bcc</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line307">307</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line308">308</a>     # Define the body of the message. This is either a Hash (in which case it</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line309">309</a>     # specifies the variables to pass to the template when it is rendered),</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line310">310</a>     # or a string, in which case it specifies the actual text of the message.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line311">311</a>     adv_attr_accessor :body</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line312">312</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line313">313</a>     # Specify the CC addresses for the message.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line314">314</a>     adv_attr_accessor :cc</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line315">315</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line316">316</a>     # Specify the charset to use for the message. This defaults to the</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line317">317</a>     # +default_charset+ specified for ActionMailer::Base.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line318">318</a>     adv_attr_accessor :charset</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line319">319</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line320">320</a>     # Specify the content type for the message. This defaults to &lt;tt&gt;text/plain&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line321">321</a>     # in most cases, but can be automatically set in some situations.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line322">322</a>     adv_attr_accessor :content_type</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line323">323</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line324">324</a>     # Specify the from address for the message.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line325">325</a>     adv_attr_accessor :from</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line326">326</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line327">327</a>     # Specify the address (if different than the &quot;from&quot; address) to direct</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line328">328</a>     # replies to this message.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line329">329</a>     adv_attr_accessor :reply_to</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line330">330</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line331">331</a>     # Specify additional headers to be added to the message.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line332">332</a>     adv_attr_accessor :headers</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line333">333</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line334">334</a>     # Specify the order in which parts should be sorted, based on content-type.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line335">335</a>     # This defaults to the value for the +default_implicit_parts_order+.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line336">336</a>     adv_attr_accessor :implicit_parts_order</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line337">337</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line338">338</a>     # Defaults to &quot;1.0&quot;, but may be explicitly given if needed.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line339">339</a>     adv_attr_accessor :mime_version</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line340">340</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line341">341</a>     # The recipient addresses for the message, either as a string (for a single</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line342">342</a>     # address) or an array (for multiple addresses).</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line343">343</a>     adv_attr_accessor :recipients</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line344">344</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line345">345</a>     # The date on which the message was sent. If not set (the default), the</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line346">346</a>     # header will be set by the delivery agent.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line347">347</a>     adv_attr_accessor :sent_on</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line348">348</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line349">349</a>     # Specify the subject of the message.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line350">350</a>     adv_attr_accessor :subject</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line351">351</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line352">352</a>     # Specify the template name to use for current message. This is the &quot;base&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line353">353</a>     # template name, without the extension or directory, and may be used to</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line354">354</a>     # have multiple mailer methods share the same template.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line355">355</a>     adv_attr_accessor :template</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line356">356</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line357">357</a>     # Override the mailer name, which defaults to an inflected version of the</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line358">358</a>     # mailer's class name. If you want to use a template in a non-standard</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line359">359</a>     # location, you can use this to specify that location.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line360">360</a>     def mailer_name(value = nil)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line361">361</a>       if value</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line362">362</a>         self.mailer_name = value</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line363">363</a>       else</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line364">364</a>         self.class.mailer_name</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line365">365</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line366">366</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line367">367</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line368">368</a>     def mailer_name=(value)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line369">369</a>       self.class.mailer_name = value</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line370">370</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line371">371</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line372">372</a>     # The mail object instance referenced by this mailer.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line373">373</a>     attr_reader :mail</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line374">374</a>     attr_reader :template_name, :default_template_name, :action_name</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line375">375</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line376">376</a>     class &lt;&lt; self</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line377">377</a>       attr_writer :mailer_name</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line378">378</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line379">379</a>       def mailer_name</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line380">380</a>         @mailer_name ||= name.underscore</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line381">381</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line382">382</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line383">383</a>       # for ActionView compatibility</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line384">384</a>       alias_method :controller_name, :mailer_name</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line385">385</a>       alias_method :controller_path, :mailer_name</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line386">386</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line387">387</a>       def respond_to?(method_symbol, include_private = false) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line388">388</a>         matches_dynamic_method?(method_symbol) || super</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line389">389</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line390">390</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line391">391</a>       def method_missing(method_symbol, *parameters) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line392">392</a>         if match = matches_dynamic_method?(method_symbol)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line393">393</a>           case match[1]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line394">394</a>             when 'create'  then new(match[2], *parameters).mail</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line395">395</a>             when 'deliver' then new(match[2], *parameters).deliver!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line396">396</a>             when 'new'     then nil</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line397">397</a>             else super</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line398">398</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line399">399</a>         else</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line400">400</a>           super</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line401">401</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line402">402</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line403">403</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line404">404</a>       # Receives a raw email, parses it into an email object, decodes it,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line405">405</a>       # instantiates a new mailer, and passes the email object to the mailer</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line406">406</a>       # object's +receive+ method. If you want your mailer to be able to</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line407">407</a>       # process incoming messages, you'll need to implement a +receive+</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line408">408</a>       # method that accepts the email object as a parameter:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line409">409</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line410">410</a>       #   class MyMailer &lt; ActionMailer::Base</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line411">411</a>       #     def receive(mail)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line412">412</a>       #       ...</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line413">413</a>       #     end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line414">414</a>       #   end</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line415">415</a>       def receive(raw_email)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line416">416</a>         logger.info &quot;Received mail:\n #{raw_email}&quot; unless logger.nil?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line417">417</a>         mail = TMail::Mail.parse(raw_email)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line418">418</a>         mail.base64_decode</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line419">419</a>         new.receive(mail)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line420">420</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line421">421</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line422">422</a>       # Deliver the given mail object directly. This can be used to deliver</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line423">423</a>       # a preconstructed mail object, like:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line424">424</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line425">425</a>       #   email = MyMailer.create_some_mail(parameters)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line426">426</a>       #   email.set_some_obscure_header &quot;frobnicate&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line427">427</a>       #   MyMailer.deliver(email)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line428">428</a>       def deliver(mail)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line429">429</a>         new.deliver!(mail)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line430">430</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line431">431</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line432">432</a>       def template_root</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line433">433</a>         self.view_paths &amp;&amp; self.view_paths.first</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line434">434</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line435">435</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line436">436</a>       def template_root=(root)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line437">437</a>         self.view_paths = ActionView::Base.process_view_paths(root)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line438">438</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line439">439</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line440">440</a>       private</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line441">441</a>         def matches_dynamic_method?(method_name) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line442">442</a>           method_name = method_name.to_s</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line443">443</a>           /^(create|deliver)_([_a-z]\w*)/.match(method_name) || /^(new)$/.match(method_name)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line444">444</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line445">445</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line446">446</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line447">447</a>     # Instantiate a new mailer object. If +method_name+ is not +nil+, the mailer</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line448">448</a>     # will be initialized according to the named method. If not, the mailer will</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line449">449</a>     # remain uninitialized (useful when you only need to invoke the &quot;receive&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line450">450</a>     # method, for instance).</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line451">451</a>     def initialize(method_name=nil, *parameters) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line452">452</a>       create!(method_name, *parameters) if method_name</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line453">453</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line454">454</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line455">455</a>     # Initialize the mailer via the given +method_name+. The body will be</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line456">456</a>     # rendered and a new TMail::Mail object created.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line457">457</a>     def create!(method_name, *parameters) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line458">458</a>       initialize_defaults(method_name)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line459">459</a>       __send__(method_name, *parameters)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line460">460</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line461">461</a>       # If an explicit, textual body has not been set, we check assumptions.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line462">462</a>       unless String === @body</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line463">463</a>         # First, we look to see if there are any likely templates that match,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line464">464</a>         # which include the content-type in their file name (i.e.,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line465">465</a>         # &quot;the_template_file.text.html.erb&quot;, etc.). Only do this if parts</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line466">466</a>         # have not already been specified manually.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line467">467</a>         if @parts.empty?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line468">468</a>           Dir.glob(&quot;#{template_path}/#{@template}.*&quot;).each do |path|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line469">469</a>             template = template_root[&quot;#{mailer_name}/#{File.basename(path)}&quot;]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line470">470</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line471">471</a>             # Skip unless template has a multipart format</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line472">472</a>             next unless template &amp;&amp; template.multipart?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line473">473</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line474">474</a>             @parts &lt;&lt; Part.new(</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line475">475</a>               :content_type =&gt; template.content_type,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line476">476</a>               :disposition =&gt; &quot;inline&quot;,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line477">477</a>               :charset =&gt; charset,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line478">478</a>               :body =&gt; render_message(template, @body)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line479">479</a>             )</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line480">480</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line481">481</a>           unless @parts.empty?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line482">482</a>             @content_type = &quot;multipart/alternative&quot; if @content_type !~ /^multipart/</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line483">483</a>             @parts = sort_parts(@parts, @implicit_parts_order)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line484">484</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line485">485</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line486">486</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line487">487</a>         # Then, if there were such templates, we check to see if we ought to</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line488">488</a>         # also render a &quot;normal&quot; template (without the content type). If a</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line489">489</a>         # normal template exists (or if there were no implicit parts) we render</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line490">490</a>         # it.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line491">491</a>         template_exists = @parts.empty?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line492">492</a>         template_exists ||= template_root[&quot;#{mailer_name}/#{@template}&quot;]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line493">493</a>         @body = render_message(@template, @body) if template_exists</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line494">494</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line495">495</a>         # Finally, if there are other message parts and a textual body exists,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line496">496</a>         # we shift it onto the front of the parts and set the body to nil (so</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line497">497</a>         # that create_mail doesn't try to render it in addition to the parts).</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line498">498</a>         if !@parts.empty? &amp;&amp; String === @body</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line499">499</a>           @parts.unshift Part.new(:charset =&gt; charset, :body =&gt; @body)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line500">500</a>           @body = nil</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line501">501</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line502">502</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line503">503</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line504">504</a>       # If this is a multipart e-mail add the mime_version if it is not</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line505">505</a>       # already set.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line506">506</a>       @mime_version ||= &quot;1.0&quot; if !@parts.empty?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line507">507</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line508">508</a>       # build the mail object itself</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line509">509</a>       @mail = create_mail</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line510">510</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line511">511</a> </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line512">512</a>     # Delivers a TMail::Mail object. By default, it delivers the cached mail</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line513">513</a>     # object (from the &lt;tt&gt;create!&lt;/tt&gt; method). If no cached mail object exists, and</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line514">514</a>     # no alternate has been given as the parameter, this will fail.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line515">515</a>     def deliver!(mail = @mail)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line516">516</a>       raise &quot;no mail object available for delivery!&quot; unless mail</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line517">517</a>       unless logger.nil?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line518">518</a>         logger.info  &quot;Sent mail to #{Array(recipients).join(', ')}&quot;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line519">519</a>         logger.debug &quot;\n#{mail.encoded}&quot;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line520">520</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line521">521</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line522">522</a>       begin</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line523">523</a>         __send__(&quot;perform_delivery_#{delivery_method}&quot;, mail) if perform_deliveries</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line524">524</a>       rescue Exception =&gt; e  # Net::SMTP errors or sendmail pipe errors</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line525">525</a>         raise e if raise_delivery_errors</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line526">526</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line527">527</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line528">528</a>       return mail</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line529">529</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line530">530</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line531">531</a>     private</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line532">532</a>       # Set up the default values for the various instance variables of this</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line533">533</a>       # mailer. Subclasses may override this method to provide different</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line534">534</a>       # defaults.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line535">535</a>       def initialize_defaults(method_name)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line536">536</a>         @charset ||= @@default_charset.dup</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line537">537</a>         @content_type ||= @@default_content_type.dup</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line538">538</a>         @implicit_parts_order ||= @@default_implicit_parts_order.dup</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line539">539</a>         @template ||= method_name</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line540">540</a>         @default_template_name = @action_name = @template</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line541">541</a>         @mailer_name ||= self.class.name.underscore</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line542">542</a>         @parts ||= []</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line543">543</a>         @headers ||= {}</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line544">544</a>         @body ||= {}</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line545">545</a>         @mime_version = @@default_mime_version.dup if @@default_mime_version</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line546">546</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line547">547</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line548">548</a>       def render_message(method_name, body)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line549">549</a>         if method_name.respond_to?(:content_type)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line550">550</a>           @current_template_content_type = method_name.content_type</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line551">551</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line552">552</a>         render :file =&gt; method_name, :body =&gt; body</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line553">553</a>       ensure</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line554">554</a>         @current_template_content_type = nil</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line555">555</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line556">556</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line557">557</a>       def render(opts)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line558">558</a>         body = opts.delete(:body)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line559">559</a>         if opts[:file] &amp;&amp; (opts[:file] !~ /\// &amp;&amp; !opts[:file].respond_to?(:render))</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line560">560</a>           opts[:file] = &quot;#{mailer_name}/#{opts[:file]}&quot;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line561">561</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line562">562</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line563">563</a>         begin</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line564">564</a>           old_template, @template = @template, initialize_template_class(body)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line565">565</a>           layout = respond_to?(:pick_layout, true) ? pick_layout(opts) : false</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line566">566</a>           @template.render(opts.merge(:layout =&gt; layout))</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line567">567</a>         ensure</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line568">568</a>           @template = old_template</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line569">569</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line570">570</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line571">571</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line572">572</a>       def default_template_format</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line573">573</a>         if @current_template_content_type</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line574">574</a>           Mime::Type.lookup(@current_template_content_type).to_sym</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line575">575</a>         else</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line576">576</a>           :html</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line577">577</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line578">578</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line579">579</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line580">580</a>       def candidate_for_layout?(options)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line581">581</a>         !self.view_paths.find_template(default_template_name, default_template_format).exempt_from_layout?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line582">582</a>       rescue ActionView::MissingTemplate</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line583">583</a>         return true</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line584">584</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line585">585</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line586">586</a>       def template_root</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line587">587</a>         self.class.template_root</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line588">588</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line589">589</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line590">590</a>       def template_root=(root)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line591">591</a>         self.class.template_root = root</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line592">592</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line593">593</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line594">594</a>       def template_path</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line595">595</a>         &quot;#{template_root}/#{mailer_name}&quot;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line596">596</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line597">597</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line598">598</a>       def initialize_template_class(assigns)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line599">599</a>         template = ActionView::Base.new(self.class.view_paths, assigns, self)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line600">600</a>         template.template_format = default_template_format</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line601">601</a>         template</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line602">602</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line603">603</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line604">604</a>       def sort_parts(parts, order = [])</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line605">605</a>         order = order.collect { |s| s.downcase }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line606">606</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line607">607</a>         parts = parts.sort do |a, b|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line608">608</a>           a_ct = a.content_type.downcase</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line609">609</a>           b_ct = b.content_type.downcase</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line610">610</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line611">611</a>           a_in = order.include? a_ct</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line612">612</a>           b_in = order.include? b_ct</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line613">613</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line614">614</a>           s = case</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line615">615</a>           when a_in &amp;&amp; b_in</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line616">616</a>             order.index(a_ct) &lt;=&gt; order.index(b_ct)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line617">617</a>           when a_in</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line618">618</a>             -1</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line619">619</a>           when b_in</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line620">620</a>             1</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line621">621</a>           else</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line622">622</a>             a_ct &lt;=&gt; b_ct</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line623">623</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line624">624</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line625">625</a>           # reverse the ordering because parts that come last are displayed</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line626">626</a>           # first in mail clients</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line627">627</a>           (s * -1)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line628">628</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line629">629</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line630">630</a>         parts</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line631">631</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line632">632</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line633">633</a>       def create_mail</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line634">634</a>         m = TMail::Mail.new</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line635">635</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line636">636</a>         m.subject,     = quote_any_if_necessary(charset, subject)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line637">637</a>         m.to, m.from   = quote_any_address_if_necessary(charset, recipients, from)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line638">638</a>         m.bcc          = quote_address_if_necessary(bcc, charset) unless bcc.nil?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line639">639</a>         m.cc           = quote_address_if_necessary(cc, charset) unless cc.nil?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line640">640</a>         m.reply_to     = quote_address_if_necessary(reply_to, charset) unless reply_to.nil?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line641">641</a>         m.mime_version = mime_version unless mime_version.nil?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line642">642</a>         m.date         = sent_on.to_time rescue sent_on if sent_on</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line643">643</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line644">644</a>         headers.each { |k, v| m[k] = v }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line645">645</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line646">646</a>         real_content_type, ctype_attrs = parse_content_type</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line647">647</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line648">648</a>         if @parts.empty?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line649">649</a>           m.set_content_type(real_content_type, nil, ctype_attrs)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line650">650</a>           m.body = normalize_new_lines(body)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line651">651</a>         else</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line652">652</a>           if String === body</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line653">653</a>             part = TMail::Mail.new</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line654">654</a>             part.body = normalize_new_lines(body)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line655">655</a>             part.set_content_type(real_content_type, nil, ctype_attrs)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line656">656</a>             part.set_content_disposition &quot;inline&quot;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line657">657</a>             m.parts &lt;&lt; part</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line658">658</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line659">659</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line660">660</a>           @parts.each do |p|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line661">661</a>             part = (TMail::Mail === p ? p : p.to_mail(self))</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line662">662</a>             m.parts &lt;&lt; part</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line663">663</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line664">664</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line665">665</a>           if real_content_type =~ /multipart/</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line666">666</a>             ctype_attrs.delete &quot;charset&quot;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line667">667</a>             m.set_content_type(real_content_type, nil, ctype_attrs)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line668">668</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line669">669</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line670">670</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line671">671</a>         @mail = m</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line672">672</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line673">673</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line674">674</a>       def perform_delivery_smtp(mail)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line675">675</a>         destinations = mail.destinations</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line676">676</a>         mail.ready_to_send</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line677">677</a>         sender = (mail['return-path'] &amp;&amp; mail['return-path'].spec) || mail['from']</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line678">678</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line679">679</a>         smtp = Net::SMTP.new(smtp_settings[:address], smtp_settings[:port])</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line680">680</a>         smtp.enable_starttls_auto if smtp_settings[:enable_starttls_auto] &amp;&amp; smtp.respond_to?(:enable_starttls_auto)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line681">681</a>         smtp.start(smtp_settings[:domain], smtp_settings[:user_name], smtp_settings[:password],</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line682">682</a>                    smtp_settings[:authentication]) do |smtp|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line683">683</a>           smtp.sendmail(mail.encoded, sender, destinations)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line684">684</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line685">685</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line686">686</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line687">687</a>       def perform_delivery_sendmail(mail)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line688">688</a>         sendmail_args = sendmail_settings[:arguments]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line689">689</a>         sendmail_args += &quot; -f \&quot;#{mail['return-path']}\&quot;&quot; if mail['return-path']</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line690">690</a>         IO.popen(&quot;#{sendmail_settings[:location]} #{sendmail_args}&quot;,&quot;w+&quot;) do |sm|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line691">691</a>           sm.print(mail.encoded.gsub(/\r/, ''))</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line692">692</a>           sm.flush</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line693">693</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line694">694</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line695">695</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line696">696</a>       def perform_delivery_test(mail)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line697">697</a>         deliveries &lt;&lt; mail</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line698">698</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line699">699</a>   end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line700">700</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line701">701</a>   Base.class_eval do</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line702">702</a>     include Helpers</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line703">703</a>     helper MailHelper</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line704">704</a>   end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line705">705</a> end</pre></td>
          </tr>
        
      </tbody>
    </table>

    <p>Generated on Sat Oct 10 16:43:24 -0400 2009 with <a href="http://github.com/relevance/rcov">rcov 0.9.3</a></p>

  </body>
</html>
